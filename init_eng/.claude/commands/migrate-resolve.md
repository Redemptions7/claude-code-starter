---
description: Interactive migration conflict resolution
---

# Interactive Migration Conflict Resolution

This command helps users resolve conflicts identified during migration to Claude Code Starter framework through an interactive process with AI suggestions.

---

## When to Use

After running `/migrate`, a `CONFLICTS.md` file appears in the project root with a list of conflicts. Use this command to interactively resolve each conflict.

---

## Conflict Resolution Process

### Step 1: Check for CONFLICTS.md

```bash
# Check if conflicts file exists
if [ ! -f "CONFLICTS.md" ]; then
  echo "‚ùå CONFLICTS.md file not found"
  echo "Migration may not have been run yet or conflicts already resolved"
  exit 1
fi
```

### Step 2: Read CONFLICTS.md

Read the entire `CONFLICTS.md` file and compile a list of all conflicts with their:
- Priority (üî¥ Critical, üü° Medium, üü¢ Low)
- Description
- Involved files

### Step 3: Create backup before starting

**CRITICAL:** Create a backup of current state before any changes:

```bash
# Create directory for conflict resolution backups
mkdir -p .conflict_resolution_backup

# Create timestamped backup
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR=".conflict_resolution_backup/before_resolve_${TIMESTAMP}"

mkdir -p "${BACKUP_DIR}"

# Backup Init/ if exists
if [ -d "Init/" ]; then
  cp -r Init/ "${BACKUP_DIR}/Init/"
fi

# Backup archive/ if exists
if [ -d "archive/" ]; then
  cp -r archive/ "${BACKUP_DIR}/archive/"
fi

# Backup CONFLICTS.md
cp CONFLICTS.md "${BACKUP_DIR}/CONFLICTS.md"

echo "‚úÖ Backup created in ${BACKUP_DIR}"
```

### Step 4: Initialize conflict resolution log

Create or update `CONFLICT_RESOLUTION_LOG.md`:

```markdown
# Migration Conflict Resolution Log

> Automatically generated by `/migrate-resolve` command

---

## Session: [DATE TIME]

### Session Information
- **Started:** [timestamp]
- **Backup:** `.conflict_resolution_backup/before_resolve_[timestamp]/`
- **Total conflicts:** [N]
- **Status:** In progress

---

[Entries for each resolved conflict will be added here]
```

### Step 5: Interactive resolution of each conflict

For **each conflict** from CONFLICTS.md:

#### 5.1. Show conflict information

```
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Conflict #[N] of [TOTAL]: [PRIORITY] [NAME]
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìã Description:
[Conflict description from CONFLICTS.md]

üìÑ Involved files:
- Legacy: [path to legacy file]
- Init:   [path to Init/ file]
```

#### 5.2. Analyze file contents

Read both files (legacy from `archive/` and new from `Init/`):

```bash
# Example reading
cat archive/[legacy-file-path]
cat Init/[init-file-path]
```

Analyze:
- **Unique content in legacy** - what's in old file but not in new
- **Unique content in Init** - what's in template but wasn't before
- **Duplicate content** - what's in both
- **Structural differences** - differences in information organization

#### 5.3. Propose smart solution (AI)

Based on analysis, propose a **specific** solution in this format:

```
ü§ñ Proposed solution (merge strategy):

[Clear description of exactly what will be done]

For example:
1. Take "Architecture" section from archive/docs/README.md (lines 45-120)
2. Insert into Init/ARCHITECTURE.md after "## Core Principles" section
3. Take User Stories from archive/docs/users.md
4. Transform into User Flows format in Init/PROJECT_INTAKE.md
5. Preserve unique technology information from legacy
6. Update Init/PROJECT_INTAKE.md "Tech Stack" section

Result:
- Init/ARCHITECTURE.md will contain concrete project architecture description
- Init/PROJECT_INTAKE.md will be filled with actual User Flows
- Init/PROJECT_INTAKE.md will contain current Tech Stack
```

**IMPORTANT:** Solution must be **maximally specific** indicating:
- Exact lines/sections to copy
- Exactly where to insert
- What transformations to apply
- What the result will be

#### 5.4. Request user confirmation

```
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Your choice:

[A] Auto-resolve - apply AI suggestion
[M] Manual resolution - I'll handle it myself later
[S] Skip - move to next conflict
[Q] Quit - finish working with conflicts

Enter choice (A/M/S/Q):
```

#### 5.5. Process user choice

**If [A] - Auto-resolve:**

1. **Apply changes:**
   - Read specified files
   - Execute described transformations
   - Use Edit tool for precise changes in Init/ files
   - DO NOT modify archive/ (legacy files remain untouched)

2. **Log the action:**
   Add to `CONFLICT_RESOLUTION_LOG.md`:
   ```markdown
   ### ‚úÖ Conflict #[N]: [Name]

   **Priority:** [üî¥üü°üü¢] [Priority]
   **Time:** [timestamp]
   **Resolution:** Auto-merge

   **Files modified:**
   - `Init/[file1]` - [what was done]
   - `Init/[file2]` - [what was done]

   **Action details:**
   1. [Action 1]
   2. [Action 2]
   3. [Action 3]

   **Sources (legacy):**
   - `archive/[legacy-file]` - [which sections taken]

   **Status:** ‚úÖ Applied successfully

   ---
   ```

3. **Update CONFLICTS.md:**
   Mark conflict as resolved by adding `‚úÖ ` at the beginning of the line:
   ```markdown
   ‚úÖ ### üü° Medium: README.md vs PROJECT_INTAKE.md
   ```

4. **Show confirmation:**
   ```
   ‚úÖ Conflict #[N] resolved successfully

   Modified files:
   - Init/[file1]
   - Init/[file2]

   Details recorded in CONFLICT_RESOLUTION_LOG.md
   ```

**If [M] - Manual resolution:**

Add to `CONFLICT_RESOLUTION_LOG.md`:
```markdown
### üë§ Conflict #[N]: [Name]

**Priority:** [Priority]
**Time:** [timestamp]
**Resolution:** Manual (user)

**Files for manual resolution:**
- Legacy: `archive/[file]`
- Init: `Init/[file]`

**AI Recommendation:**
[Your suggestion from step 5.3]

**Status:** ‚è∏Ô∏è Requires manual intervention

---
```

Show user:
```
‚è∏Ô∏è Conflict #[N] marked for manual resolution

Files:
- Legacy: archive/[file]
- Init:   Init/[file]

My recommendation saved in CONFLICT_RESOLUTION_LOG.md
```

**If [S] - Skip:**

Simply move to next conflict without logging.

**If [Q] - Quit:**

Finish process (see Step 6).

### Step 6: Finalize session

After processing all conflicts (or on [Q] command):

#### 6.1. Update log statistics

Update "Session Information" section in `CONFLICT_RESOLUTION_LOG.md`:

```markdown
### Session Information
- **Started:** [timestamp]
- **Finished:** [timestamp]
- **Backup:** `.conflict_resolution_backup/before_resolve_[timestamp]/`
- **Total conflicts:** [N]
- **Auto-resolved:** [X]
- **For manual resolution:** [Y]
- **Skipped:** [Z]
- **Status:** Completed

### Statistics
- ‚úÖ Successfully resolved: [X]
- üë§ Requires manual intervention: [Y]
- ‚è≠Ô∏è Skipped: [Z]
```

#### 6.2. Show final report

```
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         Conflict Resolution Completed
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìä Statistics:
- Total conflicts: [N]
- ‚úÖ Auto-resolved: [X]
- üë§ For manual resolution: [Y]
- ‚è≠Ô∏è Skipped: [Z]

üìù Details:
- Log: CONFLICT_RESOLUTION_LOG.md
- Updated conflicts: CONFLICTS.md
- Backup: .conflict_resolution_backup/before_resolve_[timestamp]/

üéØ Next steps:

[If Y > 0]
‚ö†Ô∏è You have [Y] conflict(s) for manual resolution.
   Review CONFLICT_RESOLUTION_LOG.md for recommendations.
   After manual resolution, you can re-run /migrate-resolve.

[If Y == 0]
‚úÖ All conflicts resolved!
   Check Init/ files and run:

   /migrate-finalize

   to complete the migration.

üì¶ Rollback:
If something went wrong, use:
/migrate-rollback --conflicts-only

Or restore from backup manually:
cp -r .conflict_resolution_backup/before_resolve_[timestamp]/Init/* Init/
```

---

## Rolling Back Conflict Resolution

### Automatic rollback via /migrate-rollback

```bash
/migrate-rollback --conflicts-only
```

This will roll back only conflict resolution changes without affecting the main migration.

### Manual rollback from backup

To roll back a specific session:

```bash
# Find the backup you need
ls -la .conflict_resolution_backup/

# Restore Init/ from backup
BACKUP_DIR=".conflict_resolution_backup/before_resolve_20250111_143022"
cp -r "${BACKUP_DIR}/Init/"* Init/

# Restore CONFLICTS.md
cp "${BACKUP_DIR}/CONFLICTS.md" CONFLICTS.md

echo "‚úÖ Rolled back to state before conflict resolution"
```

---

## Security and Best Practices

### What is guaranteed:

‚úÖ **Backup before changes:**
- All backups in `.conflict_resolution_backup/`
- Timestamped directories for each session

‚úÖ **Detailed logging:**
- Every action recorded in `CONFLICT_RESOLUTION_LOG.md`
- Can trace what, when, and why was done

‚úÖ **Legacy files untouched:**
- Never modify files in `archive/`
- Read-only for analysis

‚úÖ **Conservative approach:**
- AI only suggests but doesn't apply without confirmation
- User controls each change

‚úÖ **Rollback anytime:**
- [Q] to exit at any step
- `/migrate-rollback --conflicts-only` for complete rollback
- Manual restoration from timestamped backups

### What is NOT done:

‚ùå **Legacy files not modified:**
- `archive/` is read-only

‚ùå **Files not deleted:**
- Only adding/changing Init/ contents

‚ùå **Changes not applied without confirmation:**
- Each conflict requires explicit [A] choice

‚ùå **Migration not auto-finalized:**
- `/migrate-finalize` run separately by user

---

## Conflict Resolution Examples

### Example 1: Documentation merge

**Conflict:**
- Legacy: `archive/docs/README.md` (500 lines, detailed description)
- Init: `Init/PROJECT_INTAKE.md` (template with [FILL IN])

**AI Analysis:**
- Legacy contains: architecture description, user stories, tech stack
- Init contains: structured template with sections

**AI Proposal:**
```
ü§ñ Proposed solution (merge strategy):

1. "Architecture" section (lines 45-120) from archive/docs/README.md
   ‚Üí insert into Init/ARCHITECTURE.md after "## Core Principles"

2. "User Stories" (lines 200-350) from archive/docs/README.md
   ‚Üí transform to User Flows format
   ‚Üí insert into Init/PROJECT_INTAKE.md "User Flows" section

3. "Tech Stack" (lines 400-450) from archive/docs/README.md
   ‚Üí insert into Init/PROJECT_INTAKE.md "Tech Stack" section

Result:
- Init/ARCHITECTURE.md: filled with actual architecture
- Init/PROJECT_INTAKE.md: User Flows + Tech Stack filled
- Legacy information preserved and structured
```

**Actions on [A]:**
1. Read archive/docs/README.md
2. Extract lines 45-120
3. Edit Init/ARCHITECTURE.md - insert after "## Core Principles"
4. Extract lines 200-350, transform to User Flows format
5. Edit Init/PROJECT_INTAKE.md - fill "User Flows" section
6. Extract lines 400-450
7. Edit Init/PROJECT_INTAKE.md - fill "Tech Stack" section
8. Log to CONFLICT_RESOLUTION_LOG.md
9. Mark ‚úÖ in CONFLICTS.md

### Example 2: TODO file conflict

**Conflict:**
- Legacy: `archive/TODO.md` (task list)
- Init: `Init/BACKLOG.md` (structured backlog)

**AI Proposal:**
```
ü§ñ Proposed solution (merge strategy):

1. Read all TODO items from archive/TODO.md
2. Distribute by priority (MVP / Important / Nice-to-have)
3. Insert into appropriate sections in Init/BACKLOG.md
4. Preserve task statuses (if any)

Result:
- Init/BACKLOG.md filled with actual project tasks
- Tasks properly prioritized
- Legacy TODO not lost
```

---

## Integration with Other Commands

### With /migrate:
`/migrate` ‚Üí creates `CONFLICTS.md` ‚Üí `/migrate-resolve` ‚Üí resolves conflicts

### With /migrate-finalize:
`/migrate-resolve` ‚Üí resolves conflicts ‚Üí check Init/ ‚Üí `/migrate-finalize`

**Recommendation:** Before `/migrate-finalize` ensure that:
- All conflicts either auto-resolved ‚úÖ
- Or marked for manual üë§ and already resolved manually
- Init/ files checked and correct

### With /migrate-rollback:
If rollback needed after `/migrate-resolve`:

```bash
# Rollback only conflict resolution
/migrate-rollback --conflicts-only

# Full migration rollback (including conflict resolution)
/migrate-rollback
```

---

## FAQ

### Q: Can I run /migrate-resolve multiple times?

**A:** Yes! The command is smart:
- Skips already resolved conflicts (with ‚úÖ in CONFLICTS.md)
- Can resolve some conflicts, quit [Q], continue later
- Each session creates its own backup

### Q: What if AI proposed wrong solution?

**A:** Choose [M] (manual resolution):
- AI proposal will be saved in log as recommendation
- Resolve conflict manually
- Can re-run command for other conflicts

### Q: How to verify changes are correct?

**A:** After `/migrate-resolve`:
1. Read `CONFLICT_RESOLUTION_LOG.md` - details of all changes there
2. Check modified files in `Init/`
3. Compare with `archive/` if needed
4. Use `git diff` if repository is under git

### Q: Can I rollback just one conflict resolution?

**A:** Yes, manually:
```bash
# Find timestamped backup of needed session
ls -la .conflict_resolution_backup/

# Restore specific file
cp .conflict_resolution_backup/before_resolve_[timestamp]/Init/[file] Init/[file]
```

### Q: What to do with conflicts marked üë§ (manual)?

**A:** After manual resolution:
1. Mark ‚úÖ in `CONFLICTS.md` manually
2. Add entry to `CONFLICT_RESOLUTION_LOG.md`
3. Or just continue - `/migrate-finalize` will check

---

## Troubleshooting

### Problem: "CONFLICTS.md not found"

**Cause:** Migration not started or file deleted

**Solution:**
```bash
# Check migration status
ls -la | grep -E "(Init|archive|MIGRATION_REPORT.md)"

# If no Init/ or archive/ - migration not started
/migrate

# If exists but no CONFLICTS.md - maybe no conflicts
# Or file was deleted - restore from backup
```

### Problem: "Edit tool cannot modify file"

**Cause:** File busy or permission issues

**Solution:**
```bash
# Check permissions
ls -la Init/[file]

# If needed, grant write permissions
chmod u+w Init/[file]

# Or rollback and try again
/migrate-rollback --conflicts-only
```

### Problem: "AI proposal too generic"

**Cause:** Insufficient context for AI

**Solution:**
- Choose [M] for manual resolution
- Open files yourself
- Use AI recommendation from log as starting point

### Problem: "Want to rollback everything and start over"

**Solution:**
```bash
# Full migration rollback
/migrate-rollback

# Then start over
/migrate
/migrate-resolve
```

---

**Remember:** This command is a helper, not autopilot. You always control the process through [A/M/S/Q] choice at each step.
